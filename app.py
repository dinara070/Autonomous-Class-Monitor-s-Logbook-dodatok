import streamlit as st
from streamlit_cookies_controller import CookieController
import sqlite3
import pandas as pd
import hashlib
from datetime import datetime
import io

# --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –°–¢–û–†–Ü–ù–ö–ò ---
st.set_page_config(page_title="Autonomous Class Monitor‚Äôs Logbook", layout="wide")

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –∫—É–∫—ñ
if 'controller' not in st.session_state:
    st.session_state.controller = CookieController()
controller = st.session_state.controller

# –°–ø–∏—Å–æ–∫ –≤–∞—à–æ—ó –≥—Ä—É–ø–∏
MY_GROUP = [
    "–ê–¥–∞–º–ª—é–∫ –í–ª–∞–¥–∏—Å–ª–∞–≤ –†–æ–º–∞–Ω–æ–≤–∏—á", "–ë–∏—á–∫–æ –î–∞—Ä'—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–ë—É–≥—Ä–æ–≤–∞ –Æ–ª—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", 
    "–ë—É—Ä–µ–π–∫–æ –í–æ–ª–æ–¥–∏–º–∏—Ä –û–º–µ–ª—è–Ω–æ–≤–∏—á", "–ì–æ–Ω—á–∞—Ä—É–∫ –ê–Ω–≥–µ–ª—ñ–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ì—Ä—ñ—â–µ–Ω–∫–æ –°–≤—ñ—Ç–ª–∞–Ω–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞", 
    "–ì—É–Ω—å–∫–æ –Ü–≤–∞–Ω –†–æ–º–∞–Ω–æ–≤–∏—á", "–î–æ—Ä–æ—à –†—É—Å–ª–∞–Ω –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", "–ñ—É—Ä–∞–≤–µ–ª—å –ê–ª—å–æ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", 
    "–ó—ñ–Ω—á–µ–Ω–∫–æ –ú–∞–∫—Å–∏–º –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–ö–∞–ª—ñ–Ω—ñ–Ω –Ñ–≤–≥–µ–Ω –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ö–∏—Å—ñ–ª—å –Ø–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞", 
    "–ö–∏—Ü—è –Ø—Ä–æ—Å–ª–∞–≤ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", "–ö—Ä–∞–≤—á—É–∫ –Æ–ª—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–ú–∞—Ä—Ç–∏–Ω—é–∫ –î—ñ–∞–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", 
    "–ù–∞–∑–∞—Ä—É–∫ –î—ñ–∞–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞", "–ü–∞—Å—ñ—á–Ω–∏–∫ –°–æ—Ñ—ñ—è –ù–∞–∑–∞—Ä—ñ–≤–Ω–∞", "–ü—É—Å—Ç–æ–≤—ñ—Ç –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", 
    "–ü—É—á–∫–æ–≤–∞ –í–∞–ª–µ—Ä—ñ—è –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–°–∏—á—É–∫ –ê–Ω–≥–µ–ª—ñ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–°–ª–æ–±–æ–¥—è–Ω—é–∫ –í—ñ–∫—Ç–æ—Ä—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", 
    "–°—Ç–∞—Å—å–∫–æ–≤–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞", "–•–∞—Ä–∫–µ–≤–∏—á –†—É—Å–ª–∞–Ω –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", 
    "–ß–µ—Ä–µ—à–Ω—è –°—Ç–∞–Ω—ñ—Å–ª–∞–≤ –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ß–æ—Ä–Ω–∞ –Ñ–ª–∏–∑–∞–≤–µ—Ç–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞"
]

# –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤
SUBJECTS_LIST = [
    "–§—ñ–ª–æ—Å–æ—Ñ—ñ—è", "–Ü—Å—Ç–æ—Ä—ñ—è —ñ –∫—É–ª—å—Ç—É—Ä–∞ –£–∫—Ä–∞—ó–Ω–∏", "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ (–∑–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è–º)", "–ü–µ–¥–∞–≥–æ–≥—ñ–∫–∞",
    "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è", "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞ –¥–ª—è –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è (–º–∞–≥—ñ—Å—Ç—Ä–∏)", "–ó–∞–≥–∞–ª—å–Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è",
    "–í—ñ–∫–æ–≤–∞ —ñ –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è", "–°–æ—Ü—ñ–∞–ª—å–Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è", "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è (–∑–∞–≥–∞–ª—å–Ω–∞)", "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è –ª—ñ–¥–µ—Ä—Å—Ç–≤–∞",
    "–Ü—Å—Ç–æ—Ä—ñ—è –ø–µ–¥–∞–≥–æ–≥—ñ–∫–∏", "–ú–µ—Ç–æ–¥–∏–∫–∞ –≤–∏—Ö–æ–≤–Ω–æ—ó —Ä–æ–±–æ—Ç–∏", "–û—Å–Ω–æ–≤–∏ –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–æ—ó –º–∞–π—Å—Ç–µ—Ä–Ω–æ—Å—Ç—ñ", "–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ", 
    "–†–∏—Ç–æ—Ä–∏–∫–∞", "–õ—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞ —ñ –∫—ñ–Ω–æ", "–ü—Ä–∞–≤–∞ —Ç–∞ —Å–≤–æ–±–æ–¥–∏ –ª—é–¥–∏–Ω–∏ —ñ –≥—Ä–æ–º–∞–¥—è–Ω–∏–Ω–∞", "–¶–∏–≤—ñ–ª—å–Ω–∏–π –∑–∞—Ö–∏—Å—Ç", "–ë–µ–∑–ø–µ–∫–∞ –∂–∏—Ç—Ç—î–¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –æ—Å–Ω–æ–≤–∏ –æ—Ö–æ—Ä–æ–Ω–∏ –ø—Ä–∞—Ü—ñ",
    "–ë–∞–∑–æ–≤–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≤—ñ–π—Å—å–∫–æ–≤–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞", "–¢—Ä–µ–Ω—ñ–Ω–≥ —Ä–æ–∑–≤–∏—Ç–∫—É —Å—Ç—Ä–µ—Å–æ—Å—Ç—ñ–π–∫–æ—Å—Ç—ñ", "–î–æ–º–µ–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞", "–§—ñ–∑–∏—á–Ω–∞ –∫—É–ª—å—Ç—É—Ä–∞",
    "–ü–æ–ª—å—Å—å–∫–∞ –º–æ–≤–∞: –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∫—É—Ä—Å", "–ï–∫–æ–ª–æ–≥—ñ—è", "–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –≥—Ä–∞–º–æ—Ç–Ω—ñ—Å—Ç—å", "–ß–∏—Å–ª–æ–≤—ñ —Å–∏—Å—Ç–µ–º–∏", "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
    "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑", "–õ—ñ–Ω—ñ–π–Ω–∞ –∞–ª–≥–µ–±—Ä–∞", "–õ—ñ–Ω—ñ–π–Ω–∞ –∞–ª–≥–µ–±—Ä–∞ —ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è", "–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è",
    "–ê–ª–≥–µ–±—Ä–∞ —ñ —Ç–µ–æ—Ä—ñ—è —á–∏—Å–µ–ª", "–ï–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–ï–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –≤–∏—â–æ—ó",
    "–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç–∞ —Ä—ñ–≤–Ω—è–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ—ó —Ñ—ñ–∑–∏–∫–∏", "–†—ñ–≤–Ω—è–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ—ó —Ñ—ñ–∑–∏–∫–∏", 
    "–¢–µ–æ—Ä—ñ—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π —Ç–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "–û—Å–Ω–æ–≤–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —ñ –∞–Ω–∞–ª—ñ–∑—É –¥–∞–Ω–∏—Ö", "–ü—Ä–∏–∫–ª–∞–¥–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —è–∫–æ—Å—Ç—ñ –æ—Å–≤—ñ—Ç–∏", 
    "–ô–º–æ–≤—ñ—Ä–Ω—ñ—Å–Ω–æ-—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å", "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –ª–æ–≥—ñ–∫–∞ —ñ —Ç–µ–æ—Ä—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤", "–î–∏—Å–∫—Ä–µ—Ç–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
    "–û—Å–Ω–æ–≤–∏ –∞–ª–≥–µ–±—Ä–∏ —ñ –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ—ó –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–¢–µ–æ—Ä—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤", "–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑", "–ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑",
    "–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è —ñ —Ç–æ–ø–æ–ª–æ–≥—ñ—è", "–û—Å–Ω–æ–≤–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó", "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è", "–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–æ–∑–¥—ñ–ª–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó",
    "–ö–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–∏–∫–∞ —ñ –æ—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π", "–ú–µ—Ç–æ–¥–∏ –æ–±—á–∏—Å–ª–µ–Ω—å", "–ú–µ—Ç–æ–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π", 
    "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ —É –ø—Ä–∏–π–Ω—è—Ç—Ç—ñ —Ä—ñ—à–µ–Ω—å", "–°–∏—Å—Ç–µ–º–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —Ç–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è", "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –ø—Ä–∏—Ä–æ–¥–Ω–∏—á–∏—Ö —ñ —Å–æ—Ü—ñ–∞–ª—å–Ω–æ-–µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤", 
    "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –æ—Å–Ω–æ–≤–∏ –∑–∞—Ö–∏—Å—Ç—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó", "–Ü–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è —ñ –≤–∞—Ä—ñ–∞—Ü—ñ–π–Ω–µ —á–∏—Å–ª–µ–Ω–Ω—è", "–ê—Å–∏–º–ø—Ç–æ—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", 
    "–û—Å–Ω–æ–≤–∏ –∞–Ω–∞–ª—ñ–∑—É –§—É—Ä'—î", "–û—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó —Å–æ–ª—ñ—Ç–æ–Ω—ñ–≤", "–ê–Ω–∞–ª—ñ–∑ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ —ñ –ª–∞–Ω—Ü—é–≥–∏ –ú–∞—Ä–∫–æ–≤–∞", 
    "–°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –æ–±—Ä–æ–±–∫–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö", "–Ü—Å—Ç–æ—Ä—ñ—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞ —Ñ—ñ–∑–∏–∫–∞", 
    "–ó–∞–≥–∞–ª—å–Ω–∞ —Ñ—ñ–∑–∏–∫–∞", "–ú–µ—Ö–∞–Ω—ñ–∫–∞", "–ú–æ–ª–µ–∫—É–ª—è—Ä–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ —ñ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º—ñ–∫–∞", "–ï–ª–µ–∫—Ç—Ä–∏–∫–∞ —ñ –º–∞–≥–Ω–µ—Ç–∏–∑–º –û–ø—Ç–∏–∫–∞",
    "–ê—Ç–æ–º–Ω–∞ —ñ —è–¥–µ—Ä–Ω–∞ —Ñ—ñ–∑–∏–∫–∞", "–ü—Ä–∞–∫—Ç–∏–∫—É–º —Ä–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –∑–∞–¥–∞—á –∑ —Ñ—ñ–∑–∏–∫–∏", "–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ —Ñ—ñ–∑–∏–∫–∞",
    "–ö–ª–∞—Å–∏—á–Ω–∞ –º–µ—Ö–∞–Ω—ñ–∫–∞", "–ö–≤–∞–Ω—Ç–æ–≤–∞ –º–µ—Ö–∞–Ω—ñ–∫–∞", "–°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ —ñ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º—ñ–∫–∞", "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ —Ç–µ–æ—Ä—ñ—è —Ä–µ—á–æ–≤–∏–Ω–∏", 
    "–§—ñ–∑–∏–∫–∞ —Ç–∞ –º–µ—Ç–æ–¥–∏–∫–∞ —ó—ó –Ω–∞–≤—á–∞–Ω–Ω—è —É –ª—ñ—Ü–µ—è—Ö / –∞–∫–∞–¥–µ–º—ñ—á–Ω–∏—Ö –ª—ñ—Ü–µ—è—Ö", "–í–∏–±—Ä–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è —Å—É—á–∞—Å–Ω–æ—ó —Ñ—ñ–∑–∏–∫–∏, —Ç–µ—Ö–Ω—ñ–∫–∏, –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó", 
    "–§—ñ–∑–∏–∫–∞ –∂–∏–≤–∏—Ö —Å–∏—Å—Ç–µ–º", "–§—ñ–∑–∏—á–Ω—ñ –æ—Å–Ω–æ–≤–∏ —Ä–æ–±–æ—Ç–∏ –±—ñ–æ–º–µ–¥–∏—á–Ω–æ—ó —Ç–µ—Ö–Ω—ñ–∫–∏", "–ê—Å—Ç—Ä–æ—Ñ—ñ–∑–∏–∫–∞", "–í–∏–±—Ä–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó", 
    "–ü—Ä–∞–∫—Ç–∏–∫—É–º –∑ —Ñ—ñ–∑–∏—á–Ω–æ–≥–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É —Ç–∞ –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—á–Ω–∏—Ö —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å", "–°—É—á–∞—Å–Ω–µ –ø—Ä–∏—Ä–æ–¥–æ–∑–Ω–∞–≤—Å—Ç–≤–æ —ñ –º–µ—Ç–æ–¥–∏–∫–∞ –π–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è",
    "–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ (–∑–∞–≥–∞–ª—å–Ω–∞)", "–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", "–®–∫—ñ–ª—å–Ω–∏–π –∫—É—Ä—Å —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏", "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö",
    "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –∫—É–ª—å—Ç—É—Ä–∞", "–û—Å–Ω–æ–≤–∏ —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É", "–ú–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è –≤ –æ—Å–≤—ñ—Ç—ñ", "–ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", 
    "–°—É—á–∞—Å–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –º–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ –®–Ü –≤ –æ—Å–≤—ñ—Ç—ñ", "–ê–ª–≥–æ—Ä–∏—Ç–º–∏ —ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö",
    "–û—Å–Ω–æ–≤–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Ç–∞ –æ–±'—î–∫—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", "–û—Å–Ω–æ–≤–∏ –≤–µ–±-–ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è",
    "–ü–æ–±—É–¥–æ–≤–∞ —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ —É —à–∫—ñ–ª—å–Ω—ñ–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏—Ü—ñ", "–û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –º–µ—Ä–µ–∂–µ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –≤ —à–∫—ñ–ª—å–Ω–æ–º—É –∫—É—Ä—Å—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏",
    "–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö —Å–∏—Å—Ç–µ–º", "–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ —Å–∏—Å—Ç–µ–º–∏",
    "–°–∏—Å—Ç–µ–º–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö", "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–æ –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞–≤—á–∞–Ω–Ω—è / –≤ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ–π –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ", 
    "–¶–∏—Ñ—Ä–æ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –æ–±—Ä–æ–±–∫–∏ –≥—Ä–∞—Ñ—ñ—á–Ω–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å, –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ç–∞ –≤—ñ–¥–µ–æ", "–¶–∏—Ñ—Ä–æ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞—É–∫–æ–≤–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å", 
    "–°–∏—Å—Ç–µ–º–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–æ—ó –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º —ñ –ø—Ä–æ—Ü–µ—Å—ñ–≤", "3D-–º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è", 
    "–û—Å–Ω–æ–≤–∏ –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ–∫–∏", "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –∑–∞—Ö–∏—Å—Ç—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó", "–û—Å–Ω–æ–≤–∏ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω—ñ–∫–∏ —Ç–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", 
    "–ú–æ–±—ñ–ª—å–Ω—ñ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ / —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —É –Ω–∞–≤—á–∞–Ω–Ω—ñ", "–î–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–∏–π —Å—É–ø—Ä–æ–≤—ñ–¥ —à–∫—ñ–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å—É –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
    "–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ü—Ä–æ–≥—Ä–∞–º–Ω—ñ –∑–∞—Å–æ–±–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è", "–û—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏—Ö —Å–∏—Å—Ç–µ–º",
    "–ü–æ–≥–ª–∏–±–ª–µ–Ω–∏–π –∫—É—Ä—Å —à–∫—ñ–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏", "–Ü–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π –º–µ–¥—ñ–∞–ø—Ä–æ—Å—Ç—ñ—Ä: —î–≤—Ä–æ–ø–µ–π—Å—å–∫–∏–π –¥–æ—Å–≤—ñ–¥", 
    "–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏", "–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏", 
    "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏ —Ç–∞ –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó", "–¢–µ–æ—Ä—ñ—è —ñ –º–µ—Ç–æ–¥–∏–∫–∞ –ø–æ–≥–ª–∏–±–ª–µ–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è (–∞–ª–≥–µ–±—Ä–∏, —Å—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä—ñ—ó)",
    "–ù–∞—É–∫–æ–≤—ñ –æ—Å–Ω–æ–≤–∏ –ø–æ–≥–ª–∏–±–ª–µ–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–¢–µ–æ—Ä—ñ—è —ñ –ø—Ä–∞–∫—Ç–∏–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏—Ö / —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏—á–Ω–∏—Ö –æ–ª—ñ–º–ø—ñ–∞–¥",
    "–ü—Ä–∞–∫—Ç–∏–∫—É–º —Ä–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –æ–ª—ñ–º–ø—ñ–∞–¥–Ω–∏—Ö –∑–∞–¥–∞—á (–∞–ª–≥–µ–±—Ä–∞, –≥–µ–æ–º–µ—Ç—Ä—ñ—è)", "–í–∏–±—Ä–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è —à–∫—ñ–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å—É —Ñ—ñ–∑–∏–∫–∏ / –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", 
    "–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è —ñ –º–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞—É–∫–æ–≤–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å", "–ü–µ–¥–∞–≥–æ–≥—ñ–∫–∞ —ñ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è –≤–∏—â–æ—ó —à–∫–æ–ª–∏", "–û—Å–≤—ñ—Ç–æ–º–µ—Ç—Ä—ñ—è",
    "–ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ –≤–∏–∫–ª–∞–¥–∞—á–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –ó–í–û", "–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥, –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è –∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", 
    "–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ω–∞–≤—á–∞–ª—å–Ω–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ / –ø—Ä–æ—î–∫—Ç–Ω–æ—é –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—é", "–ú–µ—Ç–æ–¥–∏–∫–∞ —ñ–Ω–∫–ª—é–∑–∏–≤–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏",
    "–î–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫–æ-–ø—Ä–æ—î–∫—Ç—É–≤–∞–ª—å–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å –≤—á–∏—Ç–µ–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∏–π –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–∏–π –¥–æ—Å–≤—ñ–¥ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
    "–¢–µ–æ—Ä—ñ—è —ñ –ø—Ä–∞–∫—Ç–∏–∫–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑ —Ñ—ñ–∑–∏–∫–∏ –¥–æ –ó–ù–û", "–ü—Ä–∞–∫—Ç–∏–∫—É–º STEM-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É"
]

# --- –†–û–ë–û–¢–ê –ó –ë–î ---
def create_connection():
    return sqlite3.connect('attendance_private.db', check_same_thread=False)

def init_db():
    conn = create_connection()
    c = conn.cursor()
    c.execute('CREATE TABLE IF NOT EXISTS users(username TEXT PRIMARY KEY, password TEXT, full_name TEXT)')
    c.execute('''CREATE TABLE IF NOT EXISTS attendance
                 (id INTEGER PRIMARY KEY AUTOINCREMENT, student_name TEXT, date TEXT, 
                  period TEXT, subject TEXT, status TEXT, moderator TEXT)''')
    
    # –ü–ï–†–ï–í–Ü–†–ö–ê –¢–ê –û–ù–û–í–õ–ï–ù–ù–Ø –°–¢–†–£–ö–¢–£–†–ò (—â–æ–± –Ω–µ –±—É–ª–æ –ø–æ–º–∏–ª–æ–∫ —è–∫ –Ω–∞ –≤—ñ–¥–µ–æ)
    try:
        c.execute("SELECT semester FROM attendance LIMIT 1")
    except sqlite3.OperationalError:
        c.execute("ALTER TABLE attendance ADD COLUMN semester TEXT DEFAULT '2025-2'")
    conn.commit()

def make_hashes(password):
    return hashlib.sha256(str.encode(password)).hexdigest()

def check_hashes(password, hashed_text):
    return make_hashes(password) == hashed_text

# --- –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø ---
if "authenticated" not in st.session_state:
    st.session_state["authenticated"] = False

def perform_login(user_data):
    st.session_state['authenticated'] = True
    st.session_state['username'] = user_data[0]
    st.session_state['full_name'] = user_data[2]
    controller.set('remember_user', user_data[0])
    st.rerun()

# --- –û–°–ù–û–í–ù–ò–ô –î–û–î–ê–¢–û–ö ---
init_db()
conn = create_connection()

if not st.session_state["authenticated"]:
    st.title("üéì Logbook Access")
    tab1, tab2 = st.tabs(["üîë –£–≤—ñ–π—Ç–∏", "üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è"])
    c = conn.cursor()

    with tab1:
        saved_user = controller.get('remember_user')
        user = st.text_input("–õ–æ–≥—ñ–Ω", value=saved_user if saved_user else "", key="l_user")
        pwd = st.text_input("–ü–∞—Ä–æ–ª—å", type='password', key="l_pwd")
        if st.button("–£–≤—ñ–π—Ç–∏", use_container_width=True):
            c.execute('SELECT * FROM users WHERE username=?', (user,))
            data = c.fetchone()
            if data and check_hashes(pwd, data[1]):
                perform_login(data)
            else:
                st.error("–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å")

    with tab2:
        new_user = st.text_input("–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥—ñ–Ω", key="r_user")
        new_full_name = st.text_input("–í–∞—à–µ –ü–Ü–ë", key="r_name")
        new_pwd = st.text_input("–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å", type='password', key="r_pwd")
        if st.button("–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è", use_container_width=True):
            if new_user and new_pwd and new_full_name:
                try:
                    c.execute('INSERT INTO users VALUES (?,?,?)', (new_user, make_hashes(new_pwd), new_full_name))
                    conn.commit()
                    st.success("–ê–∫–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ! –£–≤—ñ–π–¥—ñ—Ç—å.")
                except:
                    st.error("–¶–µ–π –ª–æ–≥—ñ–Ω –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π")
    st.stop()

# –ú–ï–ù–Æ
st.sidebar.title(f"üë§ {st.session_state['full_name']}")
current_sem = st.sidebar.selectbox("–°–µ–º–µ—Å—Ç—Ä", ["2025-1", "2025-2", "2026-1", "2026-2"], index=1)
menu = st.sidebar.radio("–ú–µ–Ω—é", ["–ù–æ–≤–∞ –ø–µ—Ä–µ–∫–ª–∏—á–∫–∞", "–ê—Ä—Ö—ñ–≤ —Ç–∞ –ï–∫—Å–ø–æ—Ä—Ç", "–Ü–º–ø–æ—Ä—Ç", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"])

if menu == "–ù–æ–≤–∞ –ø–µ—Ä–µ–∫–ª–∏—á–∫–∞":
    st.subheader(f"üìÖ –ù–æ–≤–∏–π –∑–∞–ø–∏—Å ({current_sem})")
    with st.form("att_check_form", clear_on_submit=True):
        col1, col2, col3 = st.columns([1, 1, 2])
        date_now = col1.date_input("–î–∞—Ç–∞", datetime.now())
        period = col2.selectbox("–ü–∞—Ä–∞", ["1", "2", "3", "4", "5", "6"])
        subject = col3.selectbox("–ü—Ä–µ–¥–º–µ—Ç", sorted(SUBJECTS_LIST))
        
        st.divider()
        st.write("–í—ñ–¥–º—ñ—Ç—å—Ç–µ **–í–Ü–î–°–£–¢–ù–Ü–•** (–≤—ñ–¥ –ê –¥–æ –Ø):")
        
        absent_status = {}
        c1, c2 = st.columns(2)
        sorted_group = sorted(MY_GROUP)
        for i, student in enumerate(sorted_group):
            target_col = c1 if i % 2 == 0 else c2
            absent_status[student] = target_col.checkbox(student, key=f"ch_{i}")

        if st.form_submit_button("üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ", use_container_width=True):
            c = conn.cursor()
            d_str = date_now.strftime("%Y-%m-%d")
            for s in sorted_group:
                status = "–Ω" if absent_status[s] else ""
                c.execute("""INSERT INTO attendance 
                             (student_name, date, period, subject, status, moderator, semester) 
                             VALUES (?,?,?,?,?,?,?)""",
                          (s, d_str, period, subject, status, st.session_state['username'], current_sem))
            conn.commit()
            st.success("–£—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!")
            st.balloons()

elif menu == "–ê—Ä—Ö—ñ–≤ —Ç–∞ –ï–∫—Å–ø–æ—Ä—Ç":
    st.subheader(f"üìÇ –ê—Ä—Ö—ñ–≤ –∑–∞–ø–∏—Å—ñ–≤ ({current_sem})")
    query = f"""SELECT id, student_name, date, period, subject, status, moderator, semester 
                FROM attendance 
                WHERE semester='{current_sem}' 
                ORDER BY date DESC, period DESC, student_name ASC"""
    df = pd.read_sql(query, conn)
    
    if not df.empty:
        st.dataframe(df, use_container_width=True)
        csv = df.to_csv(index=False).encode('utf-8-sig')
        st.download_button("üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV", csv, f"attendance_{current_sem}.csv", "text/csv", use_container_width=True)
    else:
        st.info("–î–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ.")

elif menu == "–Ü–º–ø–æ—Ä—Ç":
    st.subheader("üì• –Ü–º–ø–æ—Ä—Ç –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –¥–∞–Ω–∏—Ö")
    st.info("–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏: student_name, date, period, subject, status, moderator, semester")
    
    uploaded_file = st.file_uploader("–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É (CSV –∞–±–æ Excel)", type=['csv', 'xlsx'])
    
    if uploaded_file is not None:
        try:
            # –ó—á–∏—Ç—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É
            if uploaded_file.name.endswith('.csv'):
                imp_df = pd.read_csv(uploaded_file)
            else:
                imp_df = pd.read_excel(uploaded_file)
            
            st.write("–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –¥–∞–Ω–∏—Ö:")
            st.dataframe(imp_df.head())
            
            if st.button("üöÄ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —ñ–º–ø–æ—Ä—Ç —É –±–∞–∑—É"):
                imp_df.to_sql('attendance', conn, if_exists='append', index=False)
                st.success("–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!")
                st.rerun()
        except Exception as e:
            st.error(f"–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ: {e}")

elif menu == "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":
    st.subheader("üìä –†–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ–≥—É–ª—ñ–≤ (–≤—ñ–¥ –ê –¥–æ –Ø)")
    query = f"""SELECT student_name, COUNT(*) as absences 
                FROM attendance 
                WHERE status='–Ω' AND semester='{current_sem}' 
                GROUP BY student_name 
                ORDER BY student_name ASC"""
    try:
        df_s = pd.read_sql(query, conn)
        if not df_s.empty:
            st.bar_chart(df_s.set_index('student_name'))
            st.table(df_s)
        else:
            st.success("–ü—Ä–æ–≥—É–ª—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!")
    except Exception:
        st.info("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.")

if st.sidebar.button("–í–∏–π—Ç–∏ üö™"):
    st.session_state["authenticated"] = False
    st.rerun()
